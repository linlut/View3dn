//FILE: import-ansys.cpp
// Author: Nan Zhang
// Date: June 5, 2007



//Importer for Ansys.K file
/*

$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
$                                                                              $
$                                MATERIAL CARDS                                $
$                                                                              $
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
*MAT_ORTHOTROPIC_ELASTIC_TITLE
M-4
$      MID        RO        EA        EB        EC      PRBA      PRCA      PRCB
         1   0.000251.0007E+071.0007E+071.0007E+07      0.33      0.33      0.33
$      GAB       GBC       GCA      AOPT         G      SIGF
 3756476.5 3756476.5 3756476.5                              
$       XP        YP        ZP        A1        A2        A3
                                                            
$       V1        V2        V3        D1        D2        D3      BETA       REF

$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
$                                                                              $
$                           SOLID ELEMENT SET CARDS                            $
$                                                                              $
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
*SET_SOLID_TITLE
Solid_set 1
$      SID
         1
$       K1        K2        K3        K4        K5        K6        K7        K8
       768       769       770       771       772       773       774       775
       776       777       778       779       780       781       782       810
 .....

$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
$                                                                              $
$                                NODE SET CARDS                                $
$                                                                              $
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
*SET_NODE_LIST_TITLE
Node_set 1
$      SID       DA1       DA2       DA3       DA4
         1       0.0       0.0       0.0       0.0
$     NID1      NID2      NID3      NID4      NID5      NID6      NID7      NID8
         1         3         5         7       412       413       416       801
       804       808      1212      1213      1216      1601      1604      1608
......

*SET_NODE_LIST_TITLE
Node_set 3
$      SID       DA1       DA2       DA3       DA4
         3       0.0       0.0       0.0       0.0
$     NID1      NID2      NID3      NID4      NID5      NID6      NID7      NID8
      6147      6151      6155      6156      6159      6163      6167      6168
      6171      6172      6175      6179      6183      6184      6187      6188


$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
$                                                                              $
$                              BOUNDARY SPC CARDS                              $
$                                                                              $
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
*BOUNDARY_SPC_SET_ID
$       ID
         1
$     NSID       CID      DOFX      DOFY      DOFZ     DOFRX     DOFRY     DOFRZ
         1         0         1         1         1         0         0         0
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
$                                                                              $
$                               LOAD NODE CARDS                                $
$                                                                              $
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
*LOAD_NODE_POINT
$     NODE       DOF      LCID        SF       CID        M1        M2        M3
      7804         3         1       1.0         0         0         0         0
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
$                                                                              $
$                               LOAD CURVE CARDS                               $
$                                                                              $
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
*DEFINE_CURVE_TITLE
LCur_1
$     LCID      SIDR       SFA       SFO      OFFA      OFFO    DATTYP
         1         0       1.0       1.0       0.0       0.0         0
$                 A1                  O1
                 0.0               -10.0
                 0.1               -10.0
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
$                                                                              $
$                               NODE INFORMATION                               $
$                                                                              $
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
*NODE
$    NID               X               Y               Z      TC      RC
       1             0.0             0.0             0.0     0.0     0.0
       2            0.10             0.0             0.0     0.0     0.0
       3             0.0           0.125             0.0     0.0     0.0
       4            0.10           0.125             0.0     0.0     0.0

$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
$                                                                              $
$                             ELEMENTS INFORMATION                             $
$                                                                              $
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
$                                                                              $
$                                SOLID ELEMENTS                                $
$                                                                              $
$---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
*ELEMENT_SOLID
$    EID     PID    NID1    NID2    NID3    NID4    NID5    NID6    NID7    NID8
       1       1       5       6       8       7       1       2       4       3
       2       1       9      10      11      12      13      14      15      16

  */



#include <sysconf.h>
#include <stdio.h>


inline void skip_K_comments(FILE *fp)
{
	const int BUFFLEN=2048;
	char buffer[BUFFLEN];
	while (!feof(fp)){
		int ch = fgetc(fp);
		if (ch!='$'){
			ungetc(ch, fp);
			break;
		}
		fgets(buffer, BUFFLEN-1, fp);
	}
}


bool loadAnsysDeckFile(char *fname)
{
	char *KEY_SOLID="*SET_SOLID_TITLE";

	FILE *fp = fopen(fname, _RA_);
	if (fp==NULL) return false;

	//===Read=====
	skip_K_comments(fp);



	fclose(fp);
	return true;
}